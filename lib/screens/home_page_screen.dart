// YSL Beauty Experience - Home Page Screen (mobile-first)\n// Wires JSON data (assets/data/home) to built components\n\nimport 'package:flutter/material.dart';\n\nimport '../data/home_repository.dart';\nimport '../mappers/location_mapper.dart';\nimport '../models/home_carousel_item.dart';\nimport '../models/home_content_card.dart';\nimport '../models/home_location.dart';\nimport '../models/home_map_config.dart';\nimport '../models/home_offer.dart';\nimport '../models/home_product.dart';\nimport '../models/home_quote.dart';\n\nimport '../theme/app_colors.dart';\nimport '../theme/app_text.dart';\n\nimport '../widgets/ysl_app_bar.dart';\nimport '../widgets/ysl_exclusive_offer_banner.dart';\nimport '../widgets/ysl_carousel.dart';\nimport '../widgets/ysl_location_slider.dart';\nimport '../widgets/ysl_content_card.dart';\nimport '../widgets/ysl_offer_card.dart';\n\nclass HomePageScreen extends StatefulWidget {\n  const HomePageScreen({super.key});\n\n  @override\n  State<HomePageScreen> createState() => _HomePageScreenState();\n}\n\nclass _HomeData {\n  final HomeMapConfig map;\n  final List<HomeOffer> offers;\n  final List<HomeCarouselItem> carousel;\n  final List<HomeLocation> locations;\n  final List<HomeContentCard> cards;\n  final List<HomeProduct> products;\n  final List<HomeQuote> quotes;\n\n  const _HomeData({\n    required this.map,\n    required this.offers,\n    required this.carousel,\n    required this.locations,\n    required this.cards,\n    required this.products,\n    required this.quotes,\n  });\n}\n\nclass _HomePageScreenState extends State<HomePageScreen> {\n  final _repo = HomeRepository();\n  late Future<_HomeData> _future;\n\n  @override\n  void initState() {\n    super.initState();\n    _future = _load();\n  }\n\n  Future<_HomeData> _load() async {\n    final map = await _repo.loadMapConfig();\n    final offers = await _repo.loadOffers();\n    final carousel = await _repo.loadCarousel();\n    final locations = await _repo.loadLocations();\n    final cards = await _repo.loadContentCards();\n    final products = await _repo.loadProducts();\n    final quotes = await _repo.loadQuotes();\n    return _HomeData(\n      map: map,\n      offers: offers,\n      carousel: carousel,\n      locations: locations,\n      cards: cards,\n      products: products,\n      quotes: quotes,\n    );\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      backgroundColor: AppColors.yslWhite,\n      appBar: YslAppBarVariants.version5(),\n      body: FutureBuilder<_HomeData>(\n        future: _future,\n        builder: (context, snapshot) {\n          if (snapshot.connectionState != ConnectionState.done) {\n            return const Center(child: CircularProgressIndicator());\n          }\n          if (snapshot.hasError || !snapshot.hasData) {\n            return Center(\n              child: Text(\n                'Failed to load home: \\${snapshot.error}',\n                style: AppText.bodyMedium.copyWith(color: AppColors.yslBlack),\n              ),\n            );\n          }\n          final data = snapshot.data!;\n          return _buildBody(context, data);\n        },\n      ),\n    );\n  }\n\n  Widget _buildBody(BuildContext context, _HomeData data) {\n    final firstOffer = data.offers.isNotEmpty ? data.offers.first : null;\n\n    // Map home carousel items into the widget items\n    final carouselItems = data.carousel.map((c) {\n      return YslCarouselItem(\n        imagePath: c.type == HomeCarouselItemType.image ? c.imagePath : null,\n        videoPath: c.type == HomeCarouselItemType.video ? c.videoPath : null,\n        introText: c.introText,\n        title: c.title,\n        subtitle: c.subtitle,\n        paragraph: c.paragraph,\n      );\n    }).toList(growable: false);\n\n    // Map locations to widget data\n    final yslLocations = data.locations.map(toYslLocationData).toList(growable: false);\n\n    return SingleChildScrollView(\n      child: Column(\n        crossAxisAlignment: CrossAxisAlignment.stretch,\n        children: [\n          if (firstOffer != null)\n            YslExclusiveOfferBanner(\n              text: firstOffer.text,\n              subText: null,\n              onTap: () {},\n            ),\n\n          // Hero Carousel\n          Padding(\n            padding: const EdgeInsets.symmetric(vertical: 12),\n            child: YslCarousel(\n              items: carouselItems,\n              height: 360,\n              layout: YslCarouselLayout.videoFocused,\n              backgroundColor: AppColors.yslWhite,\n            ),\n          ),\n\n          // Map background area with Location Slider overlay\n          // Placeholder map area for now (to be replaced with actual map integration)\n          SizedBox(\n            height: 260,\n            child: Stack(\n              fit: StackFit.expand,\n              children: [\n                // Map placeholder\n                Container(\n                  color: Colors.grey.shade200,\n                  child: Center(\n                    child: Text(\n                      'MAP: Marrakech\\n(\\${data.map.lat.toStringAsFixed(4)}, \\${data.map.lng.toStringAsFixed(4)})  z=\\${data.map.zoom.toStringAsFixed(0)}',\n                      style: AppText.bodySmall.copyWith(color: AppColors.yslBlack),\n                      textAlign: TextAlign.center,\n                    ),\n                  ),\n                ),\n\n                // Slider aligned to bottom\n                Align(\n                  alignment: Alignment.bottomCenter,\n                  child: Container(\n                    color: Colors.transparent,\n                    padding: const EdgeInsets.only(bottom: 8),\n                    child: YslLocationSlider(\n                      locations: yslLocations,\n                      height: 165,\n                      cardWidth: 300,\n                      cardSpacing: 12,\n                      showNavigationArrows: true,\n                      backgroundColor: Colors.transparent,\n                      showCardBorders: true,\n                    ),\n                  ),\n                ),\n              ],\n            ),\n          ),\n\n          const SizedBox(height: 16),\n\n          // Content section (first card if any)\n          if (data.cards.isNotEmpty)\n            Padding(\n              padding: const EdgeInsets.symmetric(horizontal: 16),\n              child: YslContentCard(\n                subtitle: data.cards.first.subtitle,\n                title: data.cards.first.title,\n                buttonText: data.cards.first.buttonText,\n                onButtonPressed: () {},\n                padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 28),\n              ),\n            ),\n\n          const SizedBox(height: 16),\n\n          // Product highlight using YslOfferCard\n          if (data.products.isNotEmpty)\n            Padding(\n              padding: const EdgeInsets.symmetric(horizontal: 16),\n              child: YslOfferCard(\n                title: 'FEATURED PRODUCT',\n                subtitle: data.products.first.name.toUpperCase(),\n                description: data.products.first.description,\n                buttonText: 'SHOP NOW',\n                onButtonPressed: () {},\n                isExclusive: true,\n                padding: const EdgeInsets.all(16),\n              ),\n            ),\n\n          const SizedBox(height: 24),\n        ],\n      ),\n    );\n  }\n}\n
